# 代码库模块拆分 -- 需求分析

## 背景

基于 Webpack & Vue 的前端技术日新月异，但是随着业务的不断迭代，功能页面越来越多，对应代码也会越来越多，相较于之前的代码维护到同一个仓库的拆分方案，后续管理维护非常不方便，而且会导致线上缓存失效率极高，排查问题极为困难，因此需要对前端代码库进行模块拆分

## 拆分思路

可执行方案梳理，进一步明确技术需求即选型，确定拆分思路

### 思路一

按照业务方向直接拆分页面进行模块划分，每个模块开发编译发布独立完成，公共代码维护在各自模块内部

-   优点

    -   拆分逻辑简单
    -   编译速度提升，上线快

-   缺点：
    -   公共代码不能集中维护，更新维护变得更为复杂
    -   无法完成复杂的 SPA 项目

### 思路二

在方案一的基础上，将需要 **分治、解耦** 的代码分别拆分成一个或者代码模块，然后在编译期通过 **NPM** 等手段引入

-   优点：

    -   拆分逻辑更加直接简单
    -   需要分支解耦的代码可以单独维护，降低成本

-   缺点：
    -   公共代码更新时，更新编译上线变的非常复杂
    -   公共代码无法共用 Http 缓存
    -   多代码仓库更新不同步，需要考虑 **兼容性**
    -   公共 NPM 包，有被篡改的风险

### 思路三

在思路一的基础上，将需要 **分治、解耦** 的代码拆成多个 Repo，然后通过编译期进行引入，比如 Webpack DLLPlugin

-   优点：

    -   拆分逻辑简单，几乎可以达到 **任意** 拆分
    -   需要 **分治、解耦** 的代码可以单独维护上线，降低维护成本
    -   改动可以通过一次编译上线，所依赖代码模块 **全部同时生效**

-   缺点：
    -   遵循一定的开发规范
    -   开发基于 DLLPlugin 的模式

## 需求确定

### 基本需求

-   页面功能，按照业务分类，可以任意拆分独立代码模块
-   公共代码需要独立一个或者多个模块
-   代码模块需要独立编译发布上线

### 技术需求

-   一个基于 Webpack 的插件
    -   需要处理 DLL 模式，生成 minifest 资源
    -   需要引入 DLLReference 模式，对 minifest 资源进行引入
-   对使用更加的友好，降低配置成本，不需要额外的负担

## 业界需求

目前业内只有单仓库的 DLL 配置方案，有着成熟健全的生态，基本可以满足单仓库的需求

## 自行开发插件体系

-   插件需求

    -   实现 DLL 打包构建，生成 minifest & assets 资源文件
    -   实现 DLLReference 打包构建，自动寻找 minifest & assets 资源文件进行注入
    -   自动查找需要打包构建的的 Repo，进行按需编译构建上线
    -   模块配置尽可能简单

-   优点

    -   可以使用大部分业务常见
    -   完美的实现多业务模块复用

-   缺点

    -   多仓库统一升级，可能会产生多冲突，需要制定完整的上线体系

**综上** 自主设计 mono-repo 跨模块方案
